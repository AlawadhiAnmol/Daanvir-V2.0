function init(){var t=$("#smoke").get(0);if(t.getContext){context=t.getContext("2d"),t.width=CANVAS_WIDTH,t.height=CANVAS_HEIGHT;var i=new Image,e=new Image,m=new Image;i.src="js/puff.png",e.src="js/puff.png",m.src="images/smoke_3.png",smoke_1.m_alpha=.2,smoke_3.m_speed=.001,smoke_1.init(.442,.731,90,i),smoke_2.m_alpha=.3,smoke_2.init(.522,.853,90,e),smoke_3.m_alpha=.1,smoke_3.m_speed=.02,smoke_3.init(.622,.953,90,m),requestAnimFrame(render)}}function ParticleEmitter(){this.m_x,this.m_y,this.m_dieRate,this.m_image,this.m_speed=.04,this.m_alpha=1,this.m_listParticle=[],this.init=function(t,i,e,m){this.m_x=CANVAS_WIDTH*t,this.m_y=CANVAS_HEIGHT*i,this.m_image=m,this.m_dieRate=.95;for(var s=0;e>s;s++)this.m_listParticle.push(new Particle),this.m_listParticle[s].init(this,5e4*s*this.m_speed)},this.update=function(t){for(var i=0;i<this.m_listParticle.length;i++)this.m_listParticle[i].update(t)},this.render=function(t){for(var i=0;i<this.m_listParticle.length;i++)this.m_listParticle[i].render(t)}}function Particle(){this.m_x,this.m_y,this.m_age,this.m_xVector,this.m_yVector,this.m_scale,this.m_alpha,this.m_canRegen,this.m_timeDie,this.m_emitter,this.init=function(t,i){this.m_age=i,this.m_emitter=t,this.m_canRegen=!0,this.startRand()},this.isAlive=function(){return this.m_age<this.m_timeDie},this.startRand=function(){this.m_xVector=.5*Math.random()-.25,this.m_yVector=-1.5-Math.random(),this.m_timeDie=2e4+Math.floor(12e3*Math.random());var t=1/Math.sqrt(this.m_xVector*this.m_xVector+this.m_yVector*this.m_yVector);this.m_xVector=this.m_xVector*t*this.m_emitter.m_speed,this.m_yVector=this.m_yVector*t*this.m_emitter.m_speed,this.m_x=this.m_emitter.m_x+Math.floor(20*Math.random())-10,this.m_y=this.m_emitter.m_y+Math.floor(20*Math.random())-10,this.m_x+=(this.m_xVector+windVelocity)*this.m_age,this.m_y+=-(this.m_yVector*this.m_age),this.m_scale=.01,this.m_alpha=0},this.update=function(t){if(this.m_age+=t,!this.isAlive()){if(Math.random()>this.m_emitter.m_dieRate&&(this.m_canRegen=!1),!this.m_canRegen)return;return this.m_age=0,void this.startRand()}var i,e=.05*this.m_timeDie,m=.3;this.m_age<e?(this.m_alpha=this.m_age/e,i=this.m_alpha*m,this.m_y+=2*this.m_yVector*t):(this.m_alpha=1-(this.m_age-e)/(this.m_timeDie-e),i=m,this.m_y+=this.m_yVector*t),this.m_x+=-((this.m_xVector+windVelocity)*t),this.m_alpha*=this.m_emitter.m_alpha,this.m_scale=.001+i+this.m_age/4e3},this.render=function(t){if(this.isAlive()){t.globalAlpha=this.m_alpha;var i=this.m_emitter.m_image.height*this.m_scale,e=this.m_emitter.m_image.width*this.m_scale,m=Math.round(this.m_x-e/2),s=Math.round(this.m_y+i/2);t.drawImage(this.m_emitter.m_image,m,s,e,i),dirtyLeft>m&&(dirtyLeft=m),m+e>dirtyRight&&(dirtyRight=m+e),dirtyTop>s&&(dirtyTop=s),s+i>dirtyBottom&&(dirtyBottom=s+i)}}}function render(){var t=(new Date).getTime()-lastRender;lastRender=(new Date).getTime(),context.clearRect(dirtyLeft,dirtyTop,dirtyRight-dirtyLeft,dirtyBottom-dirtyTop),dirtyLeft=1e3,dirtyTop=1e3,dirtyRight=0,dirtyBottom=0,smoke_1.update(t),smoke_1.render(context),smoke_2.update(t),smoke_2.render(context),smoke_3.update(t),smoke_3.render(context),windVelocity+=.002*(Math.random()-.5),windVelocity>.015&&(windVelocity=.015),0>windVelocity&&(windVelocity=0),requestAnimFrame(render)}var lastRender=(new Date).getTime(),context,smoke_1=new ParticleEmitter,smoke_2=new ParticleEmitter,smoke_3=new ParticleEmitter,CANVAS_WIDTH=500,CANVAS_HEIGHT=400,dirtyLeft=0,dirtyTop=0,dirtyRight=CANVAS_WIDTH,dirtyBottom=CANVAS_HEIGHT,windVelocity=.01,count=0;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,16.6)}}(),init();